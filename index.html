<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Responsive Flickr Slideshow</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
    background: #000;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .stage {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 16px;
  }

  .slide {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 16px;
    opacity: 0;
    transition: opacity 0.8s ease;
    width: 100%;
    height: 100%;
  }

  .slide.active {
    opacity: 1;
  }

  .tile {
    flex: 1 1 auto;
    max-width: 48%; /* two images per row */
    max-height: 48%;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    border-radius: 12px;
  }

  .tile img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* auto-scale images inside tile */
    display: block;
  }

</style>
</head>
<body>
<div class="stage" id="stage"></div>

<script>
const CONFIG = {
  apiKey: "4855498d62dbadaf2bd11df6fcdb9f08",
  username: "sulamitachurchpdx",
  slideDurationMs: 12000,
  refreshMs: 300000,
};

const stage = document.getElementById('stage');
let slides = [];
let slideIndex = 0;
let slideTimer = null;

async function flickrFindNSID(apiKey, username) {
  const url = new URL('https://www.flickr.com/services/rest/');
  url.searchParams.set('method', 'flickr.people.findByUsername');
  url.searchParams.set('api_key', apiKey);
  url.searchParams.set('username', username);
  url.searchParams.set('format', 'json');
  url.searchParams.set('nojsoncallback', '1');
  const r = await fetch(url);
  const data = await r.json();
  return data.user.nsid;
}

async function flickrFetchRecent(apiKey, userId) {
  const url = new URL('https://www.flickr.com/services/rest/');
  url.searchParams.set('method', 'flickr.photos.search');
  url.searchParams.set('api_key', apiKey);
  url.searchParams.set('user_id', userId);
  url.searchParams.set('min_upload_date', Math.floor(Date.now()/1000 - 7*24*60*60));
  url.searchParams.set('extras', 'url_l,url_m');
  url.searchParams.set('per_page', '250');
  url.searchParams.set('page', '1');
  url.searchParams.set('format', 'json');
  url.searchParams.set('nojsoncallback', '1');
  const r = await fetch(url);
  const data = await r.json();
  return data.photos.photo;
}

function bestImage(p) {
  let url = p.url_l || p.url_m || null;
  return url ? { url } : null;
}

function renderSlides(images) {
  stage.innerHTML = '';
  const chunkSize = 4; // number of images per slide
  for (let i=0; i<images.length; i+=chunkSize) {
    const slideEl = document.createElement('div');
    slideEl.className = 'slide';
    images.slice(i, i+chunkSize).forEach(imgObj => {
      const tile = document.createElement('div');
      tile.className = 'tile';
      const img = document.createElement('img');
      img.src = imgObj.url;
      tile.appendChild(img);
      slideEl.appendChild(tile);
    });
    stage.appendChild(slideEl);
  }
  slides = Array.from(stage.children);
  slides[0]?.classList.add('active');
}

function showNextSlide() {
  slides[slideIndex].classList.remove('active');
  slideIndex = (slideIndex + 1) % slides.length;
  slides[slideIndex].classList.add('active');
}

async function loadAndRender() {
  const userId = await flickrFindNSID(CONFIG.apiKey, CONFIG.username);
  let photos = await flickrFetchRecent(CONFIG.apiKey, userId);
  photos = photos.map(bestImage).filter(Boolean);
  renderSlides(photos);
  if (slideTimer) clearInterval(slideTimer);
  slideTimer = setInterval(showNextSlide, CONFIG.slideDurationMs);
}

window.addEventListener('resize', () => loadAndRender().catch(console.error));
loadAndRender().catch(console.error);
</script>
</body>
</html>
